#!/bin/bash

MACOS="${0%/*}"
LIB="${MACOS}/lib"
ETC="${MACOS}/etc"
EXE="${MACOS}/rawtherapee"
TMP=/tmp/RT4

export DYLD_LIBRARY_PATH="${TMP}:$DYLD_LIBRARY_PATH"
export FONTCONFIG_PATH="${ETC}/fonts"
export GDK_PIXBUF_MODULE_FILE="${ETC}/gtk-2.0/gdk-pixbuf.loaders"
export GTK2_RC_FILES="${ETC}/gtk-2.0/gtkrc"
export GTK_DATA_DIRS="${MACOS}"
export GTK_DATA_PREFIX="${MACOS}"
export GTK_EXE_PREFIX="${MACOS}"
export GTK_IM_MODULE_FILE="${ETC}/gtk-2.0/gtk.immodules"
export GTK_PATH="${MACOS}"
export PANGO_LIBDIR="${LIB}"
export PANGO_SYSCONFDIR="${ETC}"
export XDG_DATA_DIRS="${MACOS}/share:$XDG_DATA_DIRS"



{
	
	echo "=> Creating temporary directory ${TMP}"
	[ -d ${TMP} ] && rm -rf ${TMP}
	mkdir ${TMP}
	
} && {
	
	echo "=> Creating symlink to libraries and copying CUPS libraries from system directory"
	ln -s "${LIB}"/* ${TMP}
	cp /usr/lib/libcups* ${TMP}
	
} && {
	
	echo "=> Launch ${EXE}"
	[[ $1 = -d ]] && export DYLD_PRINT_LIBRARIES=1
	exec "${EXE}"
	
}
